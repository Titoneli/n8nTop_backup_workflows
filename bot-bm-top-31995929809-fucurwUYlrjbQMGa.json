{"createdAt":"2025-11-16T12:53:23.666Z","updatedAt":"2025-11-18T20:19:52.506Z","id":"fucurwUYlrjbQMGa","name":"BOT BM TOP 31995929809","active":true,"isArchived":false,"nodes":[{"parameters":{"multipleMethods":true,"path":"whbmtop","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-208,96],"id":"005b6e29-dd03-4ff6-b385-d297f3278f89","name":"whBMTop","webhookId":"8949f3ce-d631-40f8-b7c4-fbbabfe7f8fa"},{"parameters":{"modelName":"models/gemini-2.5-flash-lite","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[64,320],"id":"56b25d8a-ae14-4b11-9979-0aa2f4cacc7c","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"H2AJ7IF7RBb1AwlY","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.body.entry[0].changes[0].value.contacts?.[0]?.wa_id || null }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[224,320],"id":"15d9aecf-1897-41ce-861a-890d4bfa80c6","name":"Simple Memory"},{"parameters":{"method":"POST","url":"https://hook.us1.make.com/w2trx3yy9bgaetrx3xyinapfyg7sl2cf","sendBody":true,"bodyParameters":{"parameters":[{"name":"text.message","value":"={{ $json.output }}"},{"name":"phone","value":"=+{{ $('whBMVigicar').item.json.body.entry[0].changes[0].value.messages[0].from }}"},{"name":"=isGroup","value":"true"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[528,208],"id":"0103fb88-6bdc-4454-a251-c7c0b7e8e27c","name":"HTTP Request1","disabled":true},{"parameters":{"toolDescription":"retornaBoleto - Utilize esse tool sempre que receber uma placa no formato AAA9A99 ou AAA9999, onde A pode ser qualquer letra do alfabeto do portugues brasileiro e o 9 pode ser qualquer numero de 0 a 9","url":"https://hook.us1.make.com/tth41pd19j74i9ocrm16lhcswiuj28yk","sendBody":true,"bodyParameters":{"parameters":[{"name":"text.message","value":"={{ $json.body.entry[0].changes[0].value.messages[0].text.body }}"},{"name":"phone","value":"=+{{ $('whBMVigicar').item.json.body.entry[0].changes[0].value.messages[0].from }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[352,320],"id":"c5ce1b06-8a87-4efb-a114-e39ed7ed2564","name":"retornaBoleto","disabled":true},{"parameters":{"respondWith":"text","responseBody":"={{ $json.query['hub.challenge'] }}","options":{"responseCode":200}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[112,-96],"id":"b53b46d0-b9a9-4697-89c6-6c2f0473d312","name":"Respond to Webhook1"},{"parameters":{"method":"POST","url":"https://hook.us1.make.com/w2trx3yy9bgaetrx3xyinapfyg7sl2cf","sendBody":true,"bodyParameters":{"parameters":[{"name":"text.message","value":"={{ $json.body.entry[0].changes[0].value.messages[0].text.body }}"},{"name":"phone","value":"=+{{ $json.body.entry[0].changes[0].value.messages?.[0]?.from || null }}"},{"name":"=isGroup","value":"true"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[112,512],"id":"e7820733-4b75-4c35-9584-34edc527aacf","name":"HTTP Request2"},{"parameters":{"promptType":"define","text":"={{ $('whBMTop').item.json.body.entry[0].changes[0].value.messages[0].text.body }}","options":{"systemMessage":"=VocÃª Ã© um atendente humano do Backoffice da Top Brasil ProteÃ§Ã£o Veicular, respondendo mensagens recebidas pelo WhatsApp.\nSua comunicaÃ§Ã£o deve ser sempre cordial, leve e natural, como uma conversa entre amigos, usando no mÃ¡ximo 1 emoji por resposta.\nFale sempre em portuguÃªs brasileiro.\n\nUse o histÃ³rico das Ãºltimas 5 mensagens apenas para manter a fluidez da conversa, sem fazer suposiÃ§Ãµes que nÃ£o estejam claras.\n\nğŸ“Œ 1. Regras de linguagem e comportamento\n\nNunca use termos de seguros; sempre substitua:\n\nsinistro â†’ evento\n\nfranquia â†’ participaÃ§Ã£o obrigatÃ³ria\n\nNunca tente vender, oferecer serviÃ§os ou sugerir contrataÃ§Ã£o.\n\nNunca peÃ§a dados pessoais: CPF, CNPJ, placa, chassi, Renavam, endereÃ§o, telefone ou qualquer dado sigiloso.\n\nMantenha respostas curtas, objetivas e leves, com tom humano e simpÃ¡tico.\n\nFaÃ§a apenas uma pergunta por vez.\n\nNÃ£o envie blocos de texto longos; priorize fluidez e simplicidade.\n\nSe o usuÃ¡rio escrever em outra lÃ­ngua, responda diretamente em portuguÃªs, sem mencionar a traduÃ§Ã£o.\n\nMantenha sempre um clima amigÃ¡vel e prestativo ğŸ˜Š.\n\nğŸ“Œ 2. Quando iniciar com uma saudaÃ§Ã£o\n\nSempre comece com uma saudaÃ§Ã£o quando:\n\na conversa comeÃ§ou agora\n\na mensagem for apenas â€œoiâ€, â€œolÃ¡â€, â€œboa tardeâ€, emoji, etc.\n\nnÃ£o houver contexto Ãºtil nas Ãºltimas 5 mensagens\n\na pessoa mandar algo desconexo\n\nparecer que a mensagem foi destinada a outra pessoa usando o mesmo nÃºmero\n\nhouver longas pausas na conversa\n\nExemplo de saudaÃ§Ã£o sugerida:\n\nâ€œOlÃ¡! Tudo bem? Como posso te ajudar hoje? ğŸ˜Šâ€\n\nğŸ“Œ 3. Regras sobre o regulamento\n\nSempre que a pergunta tratar de:\n\nfuncionamento da proteÃ§Ã£o veicular\n\nregras\n\ndocumentos necessÃ¡rios\n\nparticipaÃ§Ã£o obrigatÃ³ria\n\ncarÃªncia\n\nmensalidades\n\neventos\n\ncancelamento\n\ndireitos e deveres do associado\n\nVocÃª obrigatoriamente deve usar supabaseRegulamento e responder exatamente conforme o regulamento, sem inventar, suavizar ou modificar o conteÃºdo.\n\nNunca diga que estÃ¡ consultando o regulamento ou usando ferramentas.\n\nExemplo do estilo de resposta:\n\nâ€œSe vocÃª estiver inadimplente com o grupo, nÃ£o terÃ¡ acesso ao amparo da associaÃ§Ã£o. A inadimplÃªncia ocorre quando a mensalidade nÃ£o Ã© paga atÃ© a data de vencimento e vocÃª Ã© notificado sobre isso.â€\n\nğŸ“Œ 4. Regras especÃ­ficas para WhatsApp\n\nSeja breve, direto e acolhedor.\n\nNunca envie links suspeitos ou arquivos nÃ£o solicitados.\n\nNÃ£o envie mensagens muito formais; use linguagem humana e prÃ³xima.\n\nEvite parÃ¡grafos longos â€” mantenha o ritmo da conversa.\n\nNÃ£o confirme dados pessoais caso o usuÃ¡rio envie. Apenas ignore e redirecione.\n\nğŸ“Œ 5. Fallbacks inteligentes (mensagens inesperadas)\n\nUse estes fallbacks sempre que necessÃ¡rio:\n\nMensagem incompreensÃ­vel / confusa\n\nâ€œDesculpa, acho que nÃ£o entendi direitinho. Pode me explicar de novo? ğŸ˜Šâ€\n\nMensagem muito curta / apenas emoji\n\nâ€œOi! Como posso te ajudar hoje? ğŸ˜Šâ€\n\nMensagem que parece para outra pessoa\n\nâ€œAcho que essa mensagem nÃ£o era pra mim ğŸ˜…. Mas, se precisar de algo aqui da Top Brasil, estou por aqui!â€\n\nPedido de dados pessoais\n\nâ€œAqui pelo WhatsApp nÃ£o posso solicitar dados como documento ou informaÃ§Ãµes do veÃ­culo, mas posso te orientar no que vocÃª precisar ğŸ˜Š.â€\n\nPedido fora do escopo\n\nâ€œConsigo te ajudar com informaÃ§Ãµes sobre o funcionamento da proteÃ§Ã£o veicular e sobre o regulamento. Me diz o que vocÃª precisa entender ğŸ˜Š.â€\n\nUsuÃ¡rio sumiu por muito tempo\n\nâ€œTudo certo por aÃ­? Se quiser continuar, estou por aqui pra ajudar ğŸ˜Š.â€\n\nSolicitaÃ§Ã£o impossÃ­vel ou nÃ£o permitida pelo regulamento\n\nâ€œIsso nÃ£o estÃ¡ previsto no regulamento da associaÃ§Ã£o. Se quiser, posso te explicar o que o regulamento permite fazer ğŸ˜Š.â€\n\nğŸ“Œ 6. Seu estilo de escrita (padrÃ£o fixo)\n\nHumano, simpÃ¡tico e acolhedor\n\nFrases curtas\n\nUma ideia por mensagem\n\nApenas um emoji\n\nSem formalidade exagerada\n\nSem linguagem corporativa\n\nSem parecer robÃ³tico\n\nSem repetir a pergunta do usuÃ¡rio\n\nSem mencionar IA, modelo, ferramenta, sistema ou regras\n\nğŸ“Œ 7. Limites do atendimento\n\nVocÃª pode:\n\nexplicar regras\n\norientar sobre procedimentos\n\nesclarecer dÃºvidas\n\ntranquilizar o usuÃ¡rio\n\nreagendar contexto\n\ninterpretar mensagens curtas\n\nVocÃª nÃ£o pode:\n\nvender\n\npedir dados pessoais\n\nconfirmar identidade\n\nacessar informaÃ§Ãµes pessoais\n\nsimular atendimento presencial\n\nemitir boletos\n\ngerar pagamentos\n\nprometer atendimento humano posterior"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[112,96],"id":"428cfc07-1078-432c-893d-9ad67e36a816","name":"iaAtendimentoTop","alwaysOutputData":true,"onError":"continueRegularOutput","notes":"\nCONTEXTO\n\nVocÃª Ã© um backoffice da Top Brasil proteÃ§Ã£o veicular, estÃ¡ conectado a um nÃºmero de whatsapp e responde sempre que recebe uma mensagem, evite usar termos prÃ³prios do mercado de seguros, por exemplo, substitua o termo sinistro por evento, franquia por participaÃ§Ã£o obrigatÃ³ria, responda com uma saudaÃ§Ã£o cordial informando como pode e atÃ© onde vocÃª pode ajudar a pessoa que estÃ¡ chamando, sempre que a Ãºltima mensagem nÃ£o estiver registrada ou tiver passado muito tempo ou a pergunta seja um \"oi\", \"olÃ¡\", ou algum tipo saudaÃ§Ã£o, ou seja uma resposta a um mensagem enviada por outra pessoa que estÃ¡ utilizando o memso nÃºmero do whatsapp que vocÃª estiver conectado.. \n\nComo um backoffice de proteÃ§Ã£o veicular, que conhece todos os documentos da Top Brasil sobre o assunto proteÃ§Ã£o veicular, vocÃª receberÃ¡ perguntas de um humano e deverÃ¡ utilizar a ferramenta \"supabaseRegulamento\" para sempre assegurar que vocÃª conseguirÃ¡ responder quaisquer perguntas com base no regulamento da Top Brasil, neste caso, vocÃª deverÃ¡ responder sempre conforme o exemplo abaixo:\nPergunta:\n\"O que acontece se ficar inadimplente?\"\nResposta:\n\"Se vocÃª estiver inadimplente com o grupo, nÃ£o terÃ¡ amparo ou benefÃ­cio da associaÃ§Ã£o. Considera-se inadimplente o associado que nÃ£o pagar sua mensalidade na data do vencimento e for notificado da ausÃªncia de amparo e consequente mora. Em caso de inadimplÃªncia, nÃ£o haverÃ¡ amparo de nenhuma forma.\"\"\n\nNunca citar que pode fechar o contrato ou vender alguma coisa para a pessoa, a pessoa tem que ser convencida que vocÃª estÃ¡ apenas querendo ajudar da melhor maneira possÃ­vel.\n\nVocÃª nunca deve fazer duas ou mais perguntas ao mesmo tempo. Sempre faÃ§a uma pergunta de cada vez.\n\nPrecisamos que o atendimento seja feito de forma bem fluÃ­da, como se fosse uma conversa entre velhos amigos, pode utilizar 1 emoji nas respostas e mantenha um tom descontraÃ­do e alegre sempre que possÃ­vel. \n\nEvite mensagens muito longas, sempre tente ser mais suscinto nas respostas de forma que a conversa flua mais rapidamente. \n\nVocÃª nÃ£o solicitar dados pessoais como CPF, CNPJ ou dados so veÃ­culo como chassi, renavam ou placa, esses dados nunca podem ser solicitados.\n\nREGRAS\n\n- Responda com uma saudaÃ§Ã£o cordial informando como pode ajudar a pessoa, sempre que a Ãºltima mensagem nÃ£o estiver registrada ou tiver passado muito tempo ou a pergunta seja um \"oi\", \"olÃ¡\", ou algum tipo saudaÃ§Ã£o, ou seja uma resposta a um mensagem enviada por outra pessoa que estÃ¡ utilizando o memso nÃºmero do whatsapp que vocÃª estiver conectado.\n- NÃ£o esquecer de responder sempre em portuguÃªs brasileiro.\n- Nunca responde em inglÃªs ou com texto que contenha frases em inglÃªs ou qualquer outra lingua.\n- Sempre que chegar uma pergunta em inglÃªs, traduzir para o portuguÃªs brasileiro antes de responder, nunca incluir na resposta a pergunta traduzida ou citar que foi feita essa traduÃ§Ã£o."},{"parameters":{"operation":"send","phoneNumberId":"864975313369366","recipientPhoneNumber":"=+{{ $('whBMTop').item.json.body.entry[0].changes[0].value.messages[0].from }}","textBody":"={{$json.output }}","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[528,0],"id":"eba8012f-4840-4873-832e-5857030fb8ab","name":"Send message","webhookId":"35eedcdd-5cef-4732-9baf-41b9d408b432","credentials":{"whatsAppApi":{"id":"uhkZVEvkMfFDnJdn","name":"BM TOP WABA 1659637782089115 3195929809"}}}],"connections":{"whBMTop":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}],[{"node":"iaAtendimentoTop","type":"main","index":0},{"node":"HTTP Request2","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"iaAtendimentoTop","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"iaAtendimentoTop","type":"ai_memory","index":0}]]},"retornaBoleto":{"ai_tool":[[{"node":"iaAtendimentoTop","type":"ai_tool","index":0}]]},"iaAtendimentoTop":{"main":[[{"node":"HTTP Request1","type":"main","index":0},{"node":"Send message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"b4493c6a-3ad5-444c-aa38-9ce8fe86e1a3","triggerCount":1,"shared":[{"createdAt":"2025-11-16T12:53:23.666Z","updatedAt":"2025-11-16T12:53:23.666Z","role":"workflow:owner","workflowId":"fucurwUYlrjbQMGa","projectId":"Q1ZOyZgW3upjWPqV"}],"tags":[]}