{"createdAt":"2026-01-14T18:02:22.278Z","updatedAt":"2026-01-15T22:07:04.833Z","id":"6NtzzvbzwbaHxkta","name":"SUB_GRAVA_CLIENTE_VEICULO_SGR","active":false,"isArchived":false,"nodes":[{"parameters":{"url":"https://sgr.hinova.com.br/sgr/sgrv2_api/service_api/servicos/buscar_cliente/17d3f7870b10134f9762a61f75eb711b","sendQuery":true,"queryParameters":{"parameters":[{"name":"cod_cliente","value":"={{ $('veiculo1').item.json.data?.[0]?.cod_cliente ?? 10000000 }}"}]},"sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"={{ $('Start').item.json.token }}","options":{}},"id":"456b498a-0429-4913-860d-f6900ddef009","name":"cliente1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[240,16],"alwaysOutputData":false,"onError":"continueRegularOutput"},{"parameters":{"url":"https://sgr.hinova.com.br/sgr/sgrv2_api/service_api/servicos/buscar_veiculo/17d3f7870b10134f9762a61f75eb711b","sendQuery":true,"queryParameters":{"parameters":[{"name":"cod_veiculo","value":"={{ $json.veiculo_id }}"}]},"sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"={{ $('Start').item.json.token }}","options":{}},"id":"73fa33ed-75b3-4929-8ec8-5fa15ce87051","name":"veiculo1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[16,16],"alwaysOutputData":false,"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"b9c34345-0caa-41cb-8794-059f6aa05a69","name":"veiculo_id","value":"={{ $json.veiculo_id }}","type":"string"},{"id":"d026dd22-85e6-4ec6-8bf3-c1dbedd10472","name":"placa","value":"={{ $json.placa }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-176,16],"id":"a5c5ad0f-3271-45ec-a769-061ea24b08fd","name":"Edit Fields"},{"parameters":{"operation":"executeQuery","query":"insert into public.ras_cliente (\n    cod_cliente,\n    nota_fiscal_tipo_envio_cliente,\n    codigo_secreto_cliente,\n    profissao_cliente,\n    contato_cliente,\n    data_nascimento_cliente,\n    idade,\n    formato_boleto_cliente,\n    login_cliente,\n    senha_cliente,\n    matriz_filial,\n    cod_matriz_filial,\n    nome_cliente,\n    numero_contrato_cliente,\n    rg_cliente,\n    cnh_cliente,\n    inscricao_municipal_cliente,\n    segmento_cliente,\n    senha_cliente_empresa_cliente,\n    reter_iss_cliente,\n    porcentagem_iss_cliente,\n    optante_simples_cliente,\n    nota_fiscal_cliente,\n    taxa_emissao_boleto_cliente,\n    nome_fantasia_cliente,\n    sexo_cliente,\n    estado_civil_cliente,\n    cpf_cliente,\n    situacao_descricao,\n    endereco_bairro,\n    endereco_cep,\n    endereco_cidade,\n    endereco_complemento,\n    endereco_logradouro,\n    endereco_numero,\n    endereco_uf,\n    endereco_codigo_ibge,\n    telefone_descricao,\n    telefone_contato,\n    telefone_operadora,\n    telefone_alerta,\n    telefone_situacao,\n    email_departamento,\n    email_email,\n    email_situacao,\n    ultima_atualizacao\n)\nselect\n    case when x->>'cod_cliente' ~ '^[0-9]+$'\n         then (x->>'cod_cliente')::bigint\n         else null end,\n    x->>'nota_fiscal_tipo_envio_cliente',\n    x->>'codigo_secreto_cliente',\n    x->>'profissao_cliente',\n    x->>'contato_cliente',\n    case when x->>'data_nascimento_cliente' ~ '^\\d{4}-\\d{2}-\\d{2}$'\n         then (x->>'data_nascimento_cliente')::date\n         else null end,\n    case when x->>'idade' ~ '^[0-9]+$'\n         then (x->>'idade')::int\n         else null end,\n    x->>'formato_boleto_cliente',\n    x->>'login_cliente',\n    x->>'senha_cliente',\n    x->>'matriz_filial',\n    case when x->>'cod_matriz_filial' ~ '^[0-9]+$'\n         then (x->>'cod_matriz_filial')::bigint\n         else null end,\n    x->>'nome_cliente',\n    x->>'numero_contrato_cliente',\n    x->>'rg_cliente',\n    x->>'cnh_cliente',\n    x->>'inscricao_municipal_cliente',\n    x->>'segmento_cliente',\n    x->>'senha_cliente_empresa_cliente',\n    x->>'reter_iss_cliente',\n    case\n        when x->>'porcentagem_iss_cliente' ~ '^[0-9]+(\\.[0-9]+)?$'\n        then (x->>'porcentagem_iss_cliente')::numeric\n        else null\n    end,\n    x->>'optante_simples_cliente',\n    x->>'nota_fiscal_cliente',\n    x->>'taxa_emissao_boleto_cliente',\n    x->>'nome_fantasia_cliente',\n    x->>'sexo_cliente',\n    x->>'estado_civil_cliente',\n    x->>'cpf_cliente',\n    x->'situacao'->>'descricao',\n    x->'endereco'->>'bairro',\n    x->'endereco'->>'cep',\n    x->'endereco'->>'cidade',\n    x->'endereco'->>'complemento',\n    x->'endereco'->>'logradouro',\n    x->'endereco'->>'numero',\n    x->'endereco'->>'uf',\n    x->'endereco'->>'codigoIbge',\n    x->'telefone'->0->>'descricao',\n    case\n        when length(regexp_replace(x->'telefone'->0->>'contato','\\D','','g')) = 11\n        then '55' || regexp_replace(x->'telefone'->0->>'contato','\\D','','g')\n        else regexp_replace(x->'telefone'->0->>'contato','\\D','','g')\n    end,\n    x->'telefone'->0->>'operadora',\n    x->'telefone'->0->>'alerta',\n    x->'telefone'->0->>'situacao',\n    x->'email'->0->>'Departamento',\n    x->'email'->0->>'email',\n    x->'email'->0->>'situacao',\n    now()\nfrom json_array_elements(\n    $${{ JSON.stringify($json.data) }}$$::json\n) as x\non conflict (cod_cliente)\ndo update set\n    nome_cliente = excluded.nome_cliente,\n    cpf_cliente = excluded.cpf_cliente,\n    situacao_descricao = excluded.situacao_descricao,\n    endereco_bairro = excluded.endereco_bairro,\n    endereco_cep = excluded.endereco_cep,\n    endereco_cidade = excluded.endereco_cidade,\n    endereco_logradouro = excluded.endereco_logradouro,\n    endereco_numero = excluded.endereco_numero,\n    endereco_uf = excluded.endereco_uf,\n    telefone_contato = excluded.telefone_contato,\n    email_email = excluded.email_email,\n    ultima_atualizacao = now();","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[240,-144],"id":"2fa41fb2-51e6-4b73-82d4-3a8be4f2f1db","name":"atualizaCliente1","credentials":{"postgres":{"id":"Ph2RnhkaunVC4Tqh","name":"postgresBD_ERP_TOP"}},"onError":"continueRegularOutput"},{"parameters":{"operation":"executeQuery","query":"insert into public.ras_veiculo (\n    cod_veiculo,\n    nome_cliente,\n    cod_cliente,\n    placa_veiculo,\n    matriz_filial_id,\n    forma_pagamento_adesao_veiculo,\n    cep_veiculo,\n    logradouro_veiculo,\n    numero_veiculo,\n    complemento_veiculo,\n    bairro_veiculo,\n    uf_veiculo,\n    cidade_veiculo,\n    anofab_veiculo,\n    anomod_veiculo,\n    chassi_veiculo,\n    numero_motor_veiculo,\n    renavam_veiculo,\n    km_veiculo,\n    fipe_codigo_veiculo,\n    fipe_valor_veiculo,\n    contrato_veiculo,\n    data_contrato_veiculo,\n    data_final_contrato_veiculo,\n    identificacao_veiculo,\n    observacao_veiculo,\n    modelo_veiculo,\n    marca_veiculo,\n    nome_ponto_venda,\n    situacao_veiculo,\n    nome_consultor_veiculo,\n    nome_indicador_veiculo,\n    alerta_veiculo,\n    classificacao_veiculo,\n    cor_veiculo,\n    combustivel_veiculo,\n    tipo_veiculo_veiculo,\n    valor_adesao,\n    cod_tipo_veiculo,\n    ultima_atualizacao_api,\n    ultima_atualizacao\n)\nselect\n    x.cod_veiculo::bigint,\n    x.nome_cliente,\n    x.cod_cliente::bigint,\n    x.placa_veiculo,\n    x.matriz_filial_id::bigint,\n    x.forma_pagamento_adesao_veiculo,\n    x.cep_veiculo,\n    x.logradouro_veiculo,\n    x.numero_veiculo,\n    x.complemento_veiculo,\n    x.bairro_veiculo,\n    x.uf_veiculo,\n    x.cidade_veiculo,\n    case\n        when x.anofab_veiculo ~ '^[0-9]+$'\n        then x.anofab_veiculo::int\n        else null\n    end,\n    case\n        when x.anomod_veiculo ~ '^[0-9]+$'\n        then x.anomod_veiculo::int\n        else null\n    end,\n    x.chassi_veiculo,\n    x.numero_motor_veiculo,\n    x.renavam_veiculo,\n    case\n        when x.km_veiculo ~ '^[0-9]+$'\n        then x.km_veiculo::int\n        else null\n    end,\n    x.fipe_codigo_veiculo,\n    case\n        when x.fipe_valor_veiculo ~ '^[0-9]+(\\.[0-9]+)?$'\n        then x.fipe_valor_veiculo::numeric\n        else null\n    end,\n    x.contrato_veiculo,\n    x.data_contrato_veiculo::date,\n    x.data_final_contrato_veiculo::date,\n    x.identificacao_veiculo,\n    x.observacao_veiculo,\n    x.modelo_veiculo,\n    x.marca_veiculo,\n    x.nome_ponto_venda,\n    x.situacao_veiculo,\n    x.nome_consultor_veiculo,\n    x.nome_indicador_veiculo,\n    x.alerta_veiculo,\n    x.classificacao_veiculo,\n    x.cor_veiculo,\n    x.combustivel_veiculo,\n    x.tipo_veiculo_veiculo,\n    case\n        when replace(x.valor_adesao, ',', '.') ~ '^[0-9]+(\\.[0-9]+)?$'\n        then replace(x.valor_adesao, ',', '.')::numeric\n        else null\n    end,\n    case\n        when x.cod_tipo_veiculo ~ '^[0-9]+$'\n        then x.cod_tipo_veiculo::bigint\n        else null\n    end,\n    x.ultima_atualizacao::timestamp,\n    now()\nfrom json_to_recordset(\n    $${{ JSON.stringify($json.data) }}$$::json\n) as x (\n    cod_veiculo text,\n    nome_cliente text,\n    cod_cliente text,\n    placa_veiculo text,\n    matriz_filial_id text,\n    forma_pagamento_adesao_veiculo text,\n    cep_veiculo text,\n    logradouro_veiculo text,\n    numero_veiculo text,\n    complemento_veiculo text,\n    bairro_veiculo text,\n    uf_veiculo text,\n    cidade_veiculo text,\n    anofab_veiculo text,\n    anomod_veiculo text,\n    chassi_veiculo text,\n    numero_motor_veiculo text,\n    renavam_veiculo text,\n    km_veiculo text,\n    fipe_codigo_veiculo text,\n    fipe_valor_veiculo text,\n    contrato_veiculo text,\n    data_contrato_veiculo text,\n    data_final_contrato_veiculo text,\n    identificacao_veiculo text,\n    observacao_veiculo text,\n    modelo_veiculo text,\n    marca_veiculo text,\n    nome_ponto_venda text,\n    situacao_veiculo text,\n    nome_consultor_veiculo text,\n    nome_indicador_veiculo text,\n    alerta_veiculo text,\n    classificacao_veiculo text,\n    cor_veiculo text,\n    combustivel_veiculo text,\n    tipo_veiculo_veiculo text,\n    valor_adesao text,\n    cod_tipo_veiculo text,\n    ultima_atualizacao text\n)\non conflict (cod_veiculo)\ndo update set\n    nome_cliente = excluded.nome_cliente,\n    situacao_veiculo = excluded.situacao_veiculo,\n    classificacao_veiculo = excluded.classificacao_veiculo,\n    ultima_atualizacao_api = excluded.ultima_atualizacao_api,\n    ultima_atualizacao = now();","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[16,-144],"id":"99f4656a-9f3b-42b4-ad70-2c0383a965ef","name":"atualizaVeiculo1","credentials":{"postgres":{"id":"Ph2RnhkaunVC4Tqh","name":"postgresBD_ERP_TOP"}},"onError":"continueRegularOutput"},{"parameters":{"workflowInputs":{"values":[{"name":"veiculo_id","type":"any"},{"name":"placa","type":"any"},{"name":"token","type":"any"}]}},"id":"6e9d8f5d-4fca-41b0-8d53-951b4f0b187b","typeVersion":1.1,"name":"Start","type":"n8n-nodes-base.executeWorkflowTrigger","position":[-384,16]}],"connections":{"cliente1":{"main":[[{"node":"atualizaCliente1","type":"main","index":0}]]},"veiculo1":{"main":[[{"node":"cliente1","type":"main","index":0},{"node":"atualizaVeiculo1","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"veiculo1","type":"main","index":0}]]},"Start":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","saveDataSuccessExecution":"none","saveExecutionProgress":false,"saveManualExecutions":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"5c6a549a-f2c6-4b28-9ab0-22578d52b0bf","triggerCount":0,"shared":[{"createdAt":"2026-01-14T18:02:22.278Z","updatedAt":"2026-01-14T18:02:22.278Z","role":"workflow:owner","workflowId":"6NtzzvbzwbaHxkta","projectId":"Q1ZOyZgW3upjWPqV"}],"tags":[]}