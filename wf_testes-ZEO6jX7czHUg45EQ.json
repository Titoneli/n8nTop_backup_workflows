{"createdAt":"2025-08-13T18:15:54.784Z","updatedAt":"2025-09-29T15:00:07.124Z","id":"ZEO6jX7czHUg45EQ","name":"WF_TESTES","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-720,224],"id":"9d1e3fce-ac27-4630-a6c5-fb2f92be94e3","name":"No Operation, do nothing"},{"parameters":{"resource":"messages-api","instanceName":"zap.top","remoteJid":"=553192240123","messageText":"={{\n'Olá Consultor,\\n' +\n'Hoje é aniversário do(a) nosso(a) associado ' + $('dadosAniversariantes').item.json.nome.toLowerCase().replace(/\\b\\w/g, c => c.toUpperCase()) + '.\\n' +\n'Essa é uma ótima oportunidade para fortalecer o relacionamento e mostrar que estamos sempre atentos aos momentos importantes.\\n\\n'+\n'WhatsApp de contato: 55'+ $('dadosAniversariantes').item.json.celular.match( /\\d+/g ).join('') + '\\n' +\n'Um simples gesto pode fazer toda a diferença na fidelização!\\n'+\n'Abraços,\\n'+\n'TopBrasil\\n\\n'+\n'link para abordagem:'\n}}","options_message":{"delay":3000}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-944,-96],"id":"09bd36dd-4201-4b1e-87fa-e64594f7f5e4","name":"msgDadosAniversariante","credentials":{"evolutionApi":{"id":"aemvzOqH8lEJq6Vc","name":"Evolution account"}},"onError":"continueRegularOutput"},{"parameters":{"resource":"messages-api","instanceName":"zap.top","remoteJid":"=553192240123","messageText":"={{ $('dadosAniversariantes').item.json.linkMensagem }}","options_message":{"delay":3000}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-720,-96],"id":"aa5d6cc9-f175-4e3c-bafe-43f8308444b0","name":"msgDadosAniversariante1","credentials":{"evolutionApi":{"id":"aemvzOqH8lEJq6Vc","name":"Evolution account"}},"onError":"continueRegularOutput"},{"parameters":{"method":"POST","url":"=https://api.hinova.com.br/api/sga/v2/listar/boleto-associado/periodo","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"={{ $('buscaTokenBD').item.json['descricaoDominio'] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"data_vencimento_inicial\": \"25/09/2025\",\n  \"data_vencimento_final\": \"25/09/2025\",\n  \"codigo_situacao\": 2,\n  \"link_boleto\": true,\n  \"quantidade_por_pagina\": 3000,\n  \"inicio_paginacao\": 2\n}\n","options":{"response":{"response":{"fullResponse":true}},"timeout":1000000}},"id":"cc51c2b6-f99a-4fc4-97c0-a5e19a68220a","name":"buscaBoletosPag","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-272,224],"continueOnFail":true},{"parameters":{"operation":"get","tableId":"corDominio","filters":{"conditions":[{"keyName":"idDominio","keyValue":"domTokenSGA"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-496,224],"id":"5618a598-945e-470d-9bdc-e6452de92d2f","name":"buscaTokenBD","credentials":{"supabaseApi":{"id":"S5lx7Z0EUntC6pYv","name":"Cotacao"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[176,224],"id":"1d1b7f60-78a2-4c95-a148-5280d8dc3df6","name":"loopBoletos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"63f0bce6-7f9c-40de-95c3-7cf6d2a4de9b","leftValue":"={{ $json.boletos.situacao_boleto }}","rightValue":"ABERTO","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"f9fd0d87-0187-42f1-a578-a14f2720cfb1","leftValue":"={{ $json.boletos.tipo_boleto }}","rightValue":"ACORDO FINANCEIRO","operator":{"type":"string","operation":"notEquals"}},{"id":"a6a2b332-7c4d-4c5e-8238-e5fbbb3b85ba","leftValue":"={{ $json.boletos.tipo_boleto }}","rightValue":"ACORDO JURÍDICO EXTRAJUDICIAL","operator":{"type":"string","operation":"notEquals"}},{"id":"227f2f01-8142-4565-ba19-46880b867b77","leftValue":"={{ $json.boletos.tipo_boleto }}","rightValue":"ADESÃO","operator":{"type":"string","operation":"notEquals"}},{"id":"f48225d5-b6b6-42cd-b399-665705cbfe58","leftValue":"={{ $json.boletos.tipo_boleto }}","rightValue":"MONITORAMENTO","operator":{"type":"string","operation":"notEquals"}},{"id":"375d629d-1886-4241-a120-916ad60f7046","leftValue":"={{ $json.boletos.tipo_boleto }}","rightValue":"DESINSTALAÇÃO DE EQUIPAMENTO","operator":{"type":"string","operation":"notEquals"}},{"id":"8406d4ec-0043-47c8-a687-7208f3dc0e2a","leftValue":"={{ $json.boletos.tipo_boleto }}","rightValue":"INSTALAÇÃO DE EQUIPAMENTO","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[368,224],"id":"943859e9-3319-4c89-ab21-92d3406a1a51","name":"If"},{"parameters":{"tableId":"topBoletos","fieldsUi":{"fieldValues":[{"fieldId":"codigo_associado","fieldValue":"={{ $('loopBoletos').item.json.boletos.codigo_associado }}"},{"fieldId":"nome_associado","fieldValue":"={{ $('loopBoletos').item.json.boletos.nome_associado }}"},{"fieldId":"celular","fieldValue":"={{ $('loopBoletos').item.json.boletos.celular }}"},{"fieldId":"data_emissao","fieldValue":"={{ $('loopBoletos').item.json.boletos.data_emissao }}"},{"fieldId":"data_vencimento","fieldValue":"={{ $('loopBoletos').item.json.boletos.data_vencimento }}"},{"fieldId":"data_vencimento_original","fieldValue":"={{ $('loopBoletos').item.json.boletos.data_vencimento_original }}"},{"fieldId":"tipo_boleto","fieldValue":"={{ $('loopBoletos').item.json.boletos.tipo_boleto }}"},{"fieldId":"situacao_boleto","fieldValue":"={{ $('loopBoletos').item.json.boletos.situacao_boleto }}"},{"fieldId":"valor_boleto","fieldValue":"={{ $('loopBoletos').item.json.boletos.valor_boleto }}"},{"fieldId":"link_boleto","fieldValue":"={{ $('loopBoletos').item.json.boletos.link_boleto }}"},{"fieldId":"linha_digitavel","fieldValue":"={{ $('loopBoletos').item.json.boletos.linha_digitavel }}"},{"fieldId":"placa","fieldValue":"={{ $('loopBoletos').item.json.boletos.veiculos[0].placa }}"},{"fieldId":"modelo","fieldValue":"={{ $('loopBoletos').item.json.boletos.veiculos[0].modelo }}"},{"fieldId":"codigo_regional","fieldValue":"={{ $('loopBoletos').item.json.boletos.veiculos[0].codigo_regional }}"},{"fieldId":"codigo_cooperativa","fieldValue":"={{ $('loopBoletos').item.json.boletos.veiculos[0].codigo_cooperativa }}"},{"fieldId":"codigo_voluntario","fieldValue":"={{ $('loopBoletos').item.json.boletos.veiculos[0].codigo_voluntario }}"},{"fieldId":"situacao_veiculo","fieldValue":"={{ $('loopBoletos').item.json.boletos.veiculos[0].situacao_veiculo }}"},{"fieldId":"msgBoletoEnviada","fieldValue":"false"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[576,224],"id":"1914a5f2-565f-4d14-9a94-0e9395735e04","name":"gravaBoleto","credentials":{"supabaseApi":{"id":"S5lx7Z0EUntC6pYv","name":"Cotacao"}}},{"parameters":{"fieldToSplitOut":"body.boletos","options":{"destinationFieldName":"boletos"}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-48,224],"id":"9499a75b-bd38-4d11-8448-ec60bd2b079d","name":"splitBoletos","alwaysOutputData":true},{"parameters":{"operation":"executeQuery","query":"SELECT *\nFROM public.\"topBIBoletos\"\n  WHERE \"msgBoletoEnviada\" = false\n    AND \"tipo_boleto\" = 'FECHAMENTO'\nORDER BY \"data_vencimento\"\nLIMIT 1050;\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-128,-64],"id":"d1cc3123-428e-43c8-a52d-441b90bba0b7","name":"buscaBoletos","credentials":{"postgres":{"id":"drJtZ5K1ulKtmzId","name":"top-brasil-app-integracao"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-928,864],"id":"b2c58078-586c-42dd-bc99-437f2d5f3cdf","name":"When clicking ‘Execute workflow’"},{"parameters":{"values":{"number":[{"name":"counter"}]},"options":{}},"name":"Init Counter","type":"n8n-nodes-base.set","typeVersion":1,"position":[128,864],"id":"78f25489-a653-4a74-b006-4e889c8730c9"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3c920d75-aaea-46f0-b73c-3590de62ebd0","leftValue":"={{ $json.error.status }}","rightValue":401,"operator":{"type":"number","operation":"equals"}},{"id":"54d76463-a28d-40bb-88fb-0ca340b6da0a","leftValue":"={{ $json.error.status }}","rightValue":403,"operator":{"type":"number","operation":"equals"}},{"id":"7b1c8240-0ddd-438c-9862-4788fbd0cf6a","leftValue":"={{ $json.error.status }}","rightValue":"400","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-96,864],"id":"634bd655-e319-4d84-996d-38fc70db8b80","name":"If2"},{"parameters":{"workflowId":{"__rl":true,"value":"N0Mpj3nRD1QnF7VH","mode":"list","cachedResultName":"WF_ATUALIZA_TOKEN_SGA"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["base"],"schema":[{"id":"base","displayName":"base","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[128,656],"id":"fd052af7-ee38-447b-875c-ec137bc89499","name":"Execute Workflow1","executeOnce":true},{"parameters":{"method":"POST","url":"=https://api.hinova.com.br/api/sga/v2/listar/boleto-associado/periodo","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"={{ $('buscaTokenBD1').item.json['descricaoDominio'] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"data_vencimento_inicial\": \"{{ $('dadosDatas').item.json.dtVencimentoInicial }}\",\n  \"data_vencimento_final\": \"{{ $('dadosDatas').item.json.dtVencimentoFinal }}\",\n  \"link_boleto\": false,\n  \"quantidade_por_pagina\": 100,\n  \"inicio_paginacao\": 0\n}\n","options":{"response":{"response":{"fullResponse":true}},"timeout":1000000}},"id":"8e23e07b-ee2d-4371-90d1-1d7a73e20843","name":"buscaQuantPaginas","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-304,864],"continueOnFail":true},{"parameters":{"assignments":{"assignments":[{"id":"a5ba2546-bb0c-4057-ae8e-27c8d8df705e","name":"dtVencimentoInicial","value":"=01/08/2025","type":"string"},{"id":"b22f66c6-314b-43d6-a3de-3cd8d2aef75a","name":"dtVencimentoFinal","value":"=31/08/2025","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-720,864],"id":"bd24910e-8571-4242-a183-de500c79fd5b","name":"dadosDatas"},{"parameters":{"operation":"get","tableId":"corDominio","filters":{"conditions":[{"keyName":"idDominio","keyValue":"domTokenSGA"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-512,864],"id":"a14fa17b-867f-4c6d-88ff-41400709d50f","name":"buscaTokenBD1","credentials":{"supabaseApi":{"id":"S5lx7Z0EUntC6pYv","name":"Cotacao"}}}],"connections":{"No Operation, do nothing":{"main":[[{"node":"buscaTokenBD","type":"main","index":0}]]},"msgDadosAniversariante":{"main":[[{"node":"msgDadosAniversariante1","type":"main","index":0}]]},"buscaTokenBD":{"main":[[{"node":"buscaBoletosPag","type":"main","index":0}]]},"buscaBoletosPag":{"main":[[{"node":"splitBoletos","type":"main","index":0}]]},"loopBoletos":{"main":[[],[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"gravaBoleto","type":"main","index":0}],[{"node":"loopBoletos","type":"main","index":0}]]},"gravaBoleto":{"main":[[{"node":"loopBoletos","type":"main","index":0}]]},"splitBoletos":{"main":[[{"node":"loopBoletos","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"dadosDatas","type":"main","index":0}]]},"If2":{"main":[[{"node":"Execute Workflow1","type":"main","index":0}],[{"node":"Init Counter","type":"main","index":0}]]},"Execute Workflow1":{"main":[[{"node":"buscaTokenBD1","type":"main","index":0}]]},"buscaQuantPaginas":{"main":[[{"node":"If2","type":"main","index":0}]]},"dadosDatas":{"main":[[{"node":"buscaTokenBD1","type":"main","index":0}]]},"buscaTokenBD1":{"main":[[{"node":"buscaQuantPaginas","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"199ae068-1f53-421b-a8ab-3c2e79662c26","triggerCount":0,"shared":[{"createdAt":"2025-08-13T18:15:54.784Z","updatedAt":"2025-08-13T18:15:54.784Z","role":"workflow:owner","workflowId":"ZEO6jX7czHUg45EQ","projectId":"Q1ZOyZgW3upjWPqV"}],"tags":[]}