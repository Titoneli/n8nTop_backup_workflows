{"createdAt":"2025-07-18T14:39:30.019Z","updatedAt":"2025-07-18T14:40:03.284Z","id":"csH50se7bELcP3zz","name":"WH_","active":false,"isArchived":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"evolutionGustavo","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-2608,48],"id":"227167ac-ab20-4ea3-bff2-5bdf6a706eb5","name":"Webhook","webhookId":"afb8c842-172b-45a0-bce2-58a69531a34b"},{"parameters":{"assignments":{"assignments":[{"id":"d67b53e5-111b-4e46-8678-fdff249962a0","name":"instance","value":"={{ $json.body.instance }}","type":"string"},{"id":"f939c059-fdbc-4b13-af34-0146efbbb530","name":"id","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"02a031f4-7c61-4261-89ce-d0f40e54dd4a","name":"fromMe","value":"={{ $json.body.data.key.fromMe }}","type":"string"},{"id":"67979262-4f24-46de-a7cc-cecbb0e16189","name":"conversation","value":"={{ $json.body.data.message.conversation }}","type":"string"},{"id":"783ebb02-d918-4c4c-94c3-5ae975e71cd3","name":"messageType","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"d7b02764-f3d8-4171-915a-144f1fa98525","name":"pushName","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"b0d304b3-b2a4-466e-a233-aba2856ac17c","name":"remoteJid","value":"={{ $json.body.data.key.remoteJid }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2384,48],"id":"b23010d6-0c9e-4f3d-9833-725cdbe38c90","name":"Edit Fields"},{"parameters":{"promptType":"define","text":"={{ $json.message }}","options":{"systemMessage":"=Você é um vendedor de proteção veicular para a Top Brasil, evite usar termos proóprios do mercado de seguros, por exemplo, substitua o termo sinistro por evento, franquia por participação obrigatória. \nNão esquecer de responder sempre em português brasileiro, nunca citar que você é um vendedor, a pessoa tem que ser convencida que você está apenas querendo ajudar da melhor maneira possível.\nPrecisamos que a venda seja feita de forma bem fluída, como se fosse uma conversa entre velhos amigos."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-1056,-48],"id":"18a74df6-ff6e-490f-90b1-fc5662c6aef9","name":"AI Agent"},{"parameters":{"modelName":"models/gemini-2.0-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-1088,176],"id":"497d694e-03f4-4ca2-a9b5-3958d14ee2a7","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"H2AJ7IF7RBb1AwlY","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Edit Fields').item.json.instance }} {{ $('Edit Fields').item.json.remoteJid }}","contextWindowLength":15},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-960,176],"id":"7a9e3061-4684-4610-8792-f8963fb8fcfe","name":"Simple Memory"},{"parameters":{"resource":"messages-api","instanceName":"abilio","remoteJid":"={{ $('Edit Fields').item.json.remoteJid }}","messageText":"={{ $json.output }}","options_message":{"delay":3000,"linkPreview":true}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-160,-64],"id":"5bc44691-d5f5-4e5a-9ff6-c642fcfa2102","name":"Enviar texto","credentials":{"evolutionApi":{"id":"aemvzOqH8lEJq6Vc","name":"Evolution account"}}},{"parameters":{"operation":"getAll","tableId":"documents","returnAll":true},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-832,176],"id":"2a195f4e-87d9-4f89-97b3-6f486936a9ad","name":"Get many rows in Supabase","credentials":{"supabaseApi":{"id":"neXm4avbX0TSN5Ts","name":"Trsco"}},"disabled":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"},"id":"22b9cd88-c15d-45ba-84ed-8f2b9edc5499"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"939ca3b1-a439-4fcd-afe4-7985410783ab","leftValue":"={{ $json.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2160,48],"id":"280310e4-5dfc-4071-a5bd-25308c8e6ac7","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"dc4a358d-fa54-4411-9e68-725d3048bbbd","name":"message","value":"={{ $json.conversation }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1936,-48],"id":"d3a893e9-eaaa-45d2-9d3c-8ab2ec25c231","name":"setTextMessage"},{"parameters":{"assignments":{"assignments":[{"id":"dcd39bf2-df5d-4996-89af-19803072aa98","name":"message","value":"={{ $json.message }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1248,-48],"id":"281b428b-8ab1-4a4a-a42a-5b6e4990500b","name":"Message"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-1936,144],"id":"72d52d28-b5bd-438d-8728-b3fc898121f7","name":"No Operation, do nothing"},{"parameters":{"resource":"chat-api","operation":"get-media-base64","instanceName":"={{ $json.instance }}","messageId":"={{ $json.id }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-1728,144],"id":"e8aa225e-dd0c-4af9-b5b0-19fd27ea6b99","name":"Obter m dia em base64","credentials":{"evolutionApi":{"id":"aemvzOqH8lEJq6Vc","name":"Evolution account"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.base64","options":{"mimeType":"audio/mpeg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1936,352],"id":"8444426b-6c5c-4e68-a4e5-36c77e7da737","name":"Convert to File"},{"parameters":{"method":"POST","url":"https://api.groq.com/openai/v1/audio/translations","authentication":"predefinedCredentialType","nodeCredentialType":"groqApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"model","value":"whisper-large-v3"},{"name":"prompt","value":"Specify context or spelling"},{"name":"language","value":"en"},{"name":"temperature","value":"0"},{"name":"response_format","value":"json"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1744,352],"id":"f5271763-607c-4a75-a884-b0864f3571b0","name":"HTTP Request","credentials":{"groqApi":{"id":"jUpTlpMwidIInDOX","name":"Groq account"}}},{"parameters":{"assignments":{"assignments":[{"id":"dcd39bf2-df5d-4996-89af-19803072aa98","name":"message","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1568,352],"id":"6717e26a-ab64-4fd4-b6d5-2da3c93df579","name":"setAudioMessage"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-688,-48],"id":"7ce4d4b3-6e4a-4e25-9cf9-3d301c4d9f4c","name":"No Operation, do nothing1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0155f4e5-e67d-4469-a0c3-acb5f9dd6d54","leftValue":"={{ $('Edit Fields').item.json.remoteJid }}","rightValue":"553171800557@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-480,-48],"id":"669fc16e-a40d-4f46-9b56-864f2773add4","name":"If"}],"connections":{"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Switch","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Get many rows in Supabase":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Switch":{"main":[[{"node":"setTextMessage","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"setTextMessage":{"main":[[{"node":"Message","type":"main","index":0}]]},"Message":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"No Operation, do nothing":{"main":[[{"node":"Obter m dia em base64","type":"main","index":0}]]},"Obter m dia em base64":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"setAudioMessage","type":"main","index":0}]]},"setAudioMessage":{"main":[[{"node":"Message","type":"main","index":0}]]},"No Operation, do nothing1":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Enviar texto","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"f364d9a2-9a9a-475f-bc31-616e633a5eb6","triggerCount":0,"shared":[{"createdAt":"2025-07-18T14:39:30.019Z","updatedAt":"2025-07-18T14:39:30.019Z","role":"workflow:owner","workflowId":"csH50se7bELcP3zz","projectId":"Q1ZOyZgW3upjWPqV"}],"tags":[]}