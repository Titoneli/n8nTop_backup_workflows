{"createdAt":"2025-07-19T21:28:15.603Z","updatedAt":"2025-08-22T18:50:56.179Z","id":"oFXi53GLwEl1psP2","name":"RAG_UPD_DOCUMENTOS_SUPABASE","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"2b5d859b-4bb9-4713-b440-8a217deb5474","name":"When clicking ‘Test workflow’","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-80,-480]},{"parameters":{"options":{}},"id":"863b7101-fefa-4df6-b3d4-a1d235274ecf","name":"Loop Over Items","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[544,-480]},{"parameters":{"resource":"fileFolder","filter":{"driveId":{"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1HsL-atwUpjslhLpqmdYb95KkNY2QkcNI","mode":"id"}},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[128,-480],"id":"6b9e39c1-3850-4628-9335-181fdbc8c3b0","name":"Search files and folders","credentials":{"googleDriveOAuth2Api":{"id":"7oNUZf5u7WNJM2YB","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[336,-480],"id":"e7873298-a1aa-43fb-8032-5d18e027da4d","name":"Download file","credentials":{"googleDriveOAuth2Api":{"id":"7oNUZf5u7WNJM2YB","name":"Google Drive account"}}},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $('PARAGRAFRO').item.json.fullText }}","options":{"metadata":{"metadataValues":[{"name":"ruleNumber","value":"={{ $json.ruleNumber }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[1344,-288],"id":"22587db8-2ff2-4b86-a229-cd446964a01d","name":"Default Data Loader"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[736,-480],"id":"7a8fe79b-8b96-4480-b59f-4b79e38f53a7","name":"Extract from File"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[1200,-480],"id":"1fc11e78-6733-438a-b7aa-3bda19461078","name":"Upload to Supabase","credentials":{"supabaseApi":{"id":"neXm4avbX0TSN5Ts","name":"Trsco"}}},{"parameters":{"content":"# Vectorizar Documentos ¬ Metadata\n(Para este ejemplo)","height":440,"width":1496,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-144,-592],"id":"a159bf1f-65c1-42e0-b627-76bd85285d7d","name":"Sticky Note"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[1136,-288],"id":"26d08673-5653-4a84-bd08-74484026946d","name":"Embeddings Google Gemini1","credentials":{"googlePalmApi":{"id":"H2AJ7IF7RBb1AwlY","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $('CAPÍTULO').item.json.fullText }}","options":{"metadata":{"metadataValues":[{"name":"ruleNumber","value":"={{ $json.ruleNumber }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[1344,80],"id":"f4be512b-d8e0-4da2-9ca0-e011778202b8","name":"Default Data Loader1"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[1200,-112],"id":"de9e66b3-6dc6-477f-bd8f-b99432f5c7ad","name":"Upload to Supabase1","credentials":{"supabaseApi":{"id":"neXm4avbX0TSN5Ts","name":"Trsco"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[1136,80],"id":"60b656da-06a0-4664-b925-51fd169db3eb","name":"Embeddings Google Gemini","credentials":{"googlePalmApi":{"id":"H2AJ7IF7RBb1AwlY","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"/** 1. Pega o texto completo */\nconst inputText = $input.first().json.text ?? '';\nif (!inputText) {\n\tthrow new Error('json.text está vazio ou não existe');\n}\n\n/** 2. Separa por “Regra N” (look-ahead) */\nconst ruleSections = inputText.split(/(?=§\\s+\\d+)/);\n\n/** 3. Limpa possiveis elementos vazios (antes da primera regra) */\nconst cleaned = ruleSections.filter(sec => sec.trim().startsWith('§'));\n\n/** 4. Cria os ítens de saida */\nconst outputItems = cleaned.map((ruleText, idx) => {\n\n\t// 4-a) Número da regra\n\tconst nMatch = ruleText.match(/§\\s+(\\d+)/);\n\tconst ruleNumber = nMatch ? nMatch[1] : String(idx + 1);\n\n\t// 4-b) Título \n\t//      Ejemplo: \"Regra 3 - Incendio\"\n\tconst tMatch = ruleText.match(/§\\s+\\d+\\s*[-–]\\s*(.+?)(?:\\n|$)/);\n\tconst ruleTitle = tMatch ? tMatch[1].trim() : 'Titulo nao encontrado';\n\n\treturn {\n\t\tjson: {\n\t\t\truleNumber,        // \"3\"\n\t\t\truleTitle,         // \"Incendio\"\n\t\t\tfullText: ruleText.trim(),\n\t\t\toriginalIndex: idx // 0-based\n\t\t},\n\t};\n});\n\n/** 5. Devolver array */\nreturn outputItems;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1056,-480],"id":"3f6992bf-f452-4bee-87ef-349e18984311","name":"PARAGRAFRO","alwaysOutputData":true},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $('ARTIGO').item.json.fullText }}","options":{"metadata":{"metadataValues":[{"name":"ruleNumber","value":"={{ $json.ruleNumber }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[1328,448],"id":"d620d65a-e07e-44a5-9a47-62d3cd28cb3f","name":"Default Data Loader2"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[1184,256],"id":"43d6c98e-267f-45aa-baf1-9201bb28ede5","name":"Upload to Supabase2","credentials":{"supabaseApi":{"id":"neXm4avbX0TSN5Ts","name":"Trsco"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[1120,448],"id":"a189c2a1-6632-40ed-addd-a9d795b2efc7","name":"Embeddings Google Gemini2","credentials":{"googlePalmApi":{"id":"H2AJ7IF7RBb1AwlY","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsCode":"/** 1. Pega o texto completo */\nconst inputText = $input.first().json.text ?? '';\nif (!inputText) {\n\tthrow new Error('json.text está vazio ou não existe');\n}\n\n/** 2. Separa por “Regra N” (look-ahead) */\nconst ruleSections = inputText.split(/(?=Art.\\s+\\d+)/);\n\n/** 3. Limpa possiveis elementos vazios (antes da primera regra) */\nconst cleaned = ruleSections.filter(sec => sec.trim().startsWith('Art.'));\n\n/** 4. Cria os ítens de saida */\nconst outputItems = cleaned.map((ruleText, idx) => {\n\n\t// 4-a) Número da regra\n\tconst nMatch = ruleText.match(/Art.\\s+(\\d+)/);\n\tconst ruleNumber = nMatch ? nMatch[1] : String(idx + 1);\n\n\t// 4-b) Título \n\t//      Ejemplo: \"Regra 3 - Incendio\"\n\tconst tMatch = ruleText.match(/Art.\\s+\\d+\\s*[-–]\\s*(.+?)(?:\\n|$)/);\n\tconst ruleTitle = tMatch ? tMatch[1].trim() : 'Titulo nao encontrado';\n\n\treturn {\n\t\tjson: {\n\t\t\truleNumber,        // \"3\"\n\t\t\truleTitle,         // \"Incendio\"\n\t\t\tfullText: ruleText.trim(),\n\t\t\toriginalIndex: idx // 0-based\n\t\t},\n\t};\n});\n\n/** 5. Devolver array */\nreturn outputItems;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1040,256],"id":"8de1b6d5-21e0-45ab-b374-4917534e43ce","name":"ARTIGO","alwaysOutputData":true},{"parameters":{"jsCode":"// ─────────────────────────────────────────────────────────────────────────────\n// n8n Code Node – Dividir «Regla X» en ítems independientes\n// Entrada : 1er ítem → .json.text  (todas las reglas juntas)\n// Salida  : un ítem por regla, con número, título, texto completo e índice\n// ─────────────────────────────────────────────────────────────────────────────\n\n/** 1. Obtener el texto completo */\nconst inputText = $input.first().json.text ?? '';\nif (!inputText) {\n\tthrow new Error('El campo json.text está vacío o no existe');\n}\n\n/** 2. Partir por “Regla N” (look-ahead para conservar el encabezado) */\nconst ruleSections = inputText.split(/(?=Art.\\s+\\d+)/);\n\n/** 3. Limpiar posibles elementos vacíos (antes de la primera regla) */\nconst cleaned = ruleSections.filter(sec => sec.trim().startsWith('Art.'));\n\n/** 4. Crear los ítems de salida */\nconst outputItems = cleaned.map((ruleText, idx) => {\n\n\t// 4-a) Número de regla\n\tconst nMatch = ruleText.match(/Art.\\s+(\\d+)/);\n\tconst ruleNumber = nMatch ? nMatch[1] : String(idx + 1);\n\n\t// 4-b) Título (lo que va tras el guion y antes del salto de línea)\n\t//      Ejemplo: \"Regla 3 - Stroke Play (Juego por Golpes)\"\n\tconst tMatch = ruleText.match(/Art.\\s+\\d+\\s*[-–]\\s*(.+?)(?:\\n|$)/);\n\tconst ruleTitle = tMatch ? tMatch[1].trim() : 'Título no encontrado';\n\n\treturn {\n\t\tjson: {\n\t\t\truleNumber,        // \"3\"\n\t\t\truleTitle,         // \"Stroke Play (Juego por Golpes)\"\n\t\t\tfullText: ruleText.trim(),\n\t\t\toriginalIndex: idx // 0-based\n\t\t},\n\t};\n});\n\n/** 5. Devolver el array de ítems */\nreturn outputItems;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1024,-112],"id":"78c2d036-f707-4e24-8525-d498acc6efb7","name":"Code"}],"connections":{"When clicking ‘Test workflow’":{"main":[[{"node":"Search files and folders","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Extract from File","type":"main","index":0}]]},"Search files and folders":{"main":[[{"node":"Download file","type":"main","index":0}]]},"Download file":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Upload to Supabase","type":"ai_document","index":0}]]},"Extract from File":{"main":[[{"node":"PARAGRAFRO","type":"main","index":0}]]},"Embeddings Google Gemini1":{"ai_embedding":[[{"node":"Upload to Supabase","type":"ai_embedding","index":0}]]},"Upload to Supabase":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Default Data Loader1":{"ai_document":[[{"node":"Upload to Supabase1","type":"ai_document","index":0}]]},"Embeddings Google Gemini":{"ai_embedding":[[{"node":"Upload to Supabase1","type":"ai_embedding","index":0}]]},"PARAGRAFRO":{"main":[[{"node":"Upload to Supabase","type":"main","index":0}]]},"Upload to Supabase1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Default Data Loader2":{"ai_document":[[{"node":"Upload to Supabase2","type":"ai_document","index":0}]]},"Embeddings Google Gemini2":{"ai_embedding":[[{"node":"Upload to Supabase2","type":"ai_embedding","index":0}]]},"ARTIGO":{"main":[[{"node":"Upload to Supabase2","type":"main","index":0}]]},"Upload to Supabase2":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Code":{"main":[[{"node":"Upload to Supabase1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"58658c21-f82d-467d-9a56-2c3aa2430c8e","triggerCount":0,"shared":[{"createdAt":"2025-07-19T21:28:15.603Z","updatedAt":"2025-07-19T21:28:15.603Z","role":"workflow:owner","workflowId":"oFXi53GLwEl1psP2","projectId":"Q1ZOyZgW3upjWPqV"}],"tags":[]}